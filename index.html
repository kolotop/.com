<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <title>KOLO ‚Äî –¥–æ—à–∫–∞ –æ–≥–æ–ª–æ—à–µ–Ω—å</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover,user-scalable=no"/>
  <meta name="format-detection" content="telephone=no"/>
  <meta name="theme-color" content="#10b981"/>
  <meta name="description" content="KOLO: –¥–æ–¥–∞–π –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –∑–∞ —Ö–≤–∏–ª–∏–Ω—É. –§—ñ–ª—å—Ç—Ä–∏, HOT-–¢–û–ü, –≥–∞–ª–µ—Ä–µ—è, –ª–∞–π–∫–∏ —Ç–∞ –ø–µ—Ä–µ–≥–ª—è–¥–∏.">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{--green:#10b981;--dark:#0b7d60;--red:#ef4444;--bg:#f7f7f7;--txt:#111}
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:Montserrat,system-ui,Arial;background:#fff;color:var(--txt)}
    a{color:inherit;text-decoration:none}
    header{position:sticky;top:0;z-index:20;background:#fff;border-bottom:1px solid #eee}
    .wrap{max-width:1100px;margin:0 auto;padding:12px 16px}
    .top{display:flex;align-items:center;gap:14px}
    .logo{display:flex;align-items:center;gap:12px;font-weight:800}
    .logo svg{width:42px;height:42px}
    .pill{background:var(--green);color:#fff;padding:6px 10px;border-radius:999px;font-size:12px}
    .search-row{display:grid;grid-template-columns:1fr 120px 120px 120px;gap:10px;margin-top:10px}
    .search-row input,.search-row select{border:1px solid #e5e7eb;border-radius:10px;padding:10px 12px;font-size:14px}
    .btn{background:var(--green);color:#fff;border:none;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
    .btn.secondary{background:#eafaf3;color:#066}
    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
    .card{border:1px solid #eee;border-radius:16px;overflow:hidden;background:#fff;display:flex;flex-direction:column;cursor:pointer}
    .tag{position:absolute;left:8px;top:8px;background:var(--red);color:#fff;padding:4px 8px;border-radius:10px;font-size:12px;font-weight:800}
    .imgbox{position:relative;width:100%;aspect-ratio:4/3;overflow:hidden;background:#f0f0f0}
    .imgbox img{width:100%;height:100%;object-fit:cover;display:block}
    .ct{padding:10px 12px;display:flex;flex-direction:column;gap:6px}
    .title{font-weight:700;line-height:1.2}
    .price{display:inline-flex;align-items:center}
    .chip{background:#f1fff9;border:1px solid #d7f3e9;color:#066;padding:4px 8px;border-radius:10px;font-size:12px;font-weight:700}
    .meta{display:flex;gap:12px;font-size:12px;color:#666}
    .meta .dot::before{content:'‚Ä¢';margin:0 6px;color:#ddd}
    .actions{display:flex;justify-content:space-between;align-items:center;margin-top:auto;padding-top:6px}
    .actions button{border:1px solid #e5e7eb;background:#fff;border-radius:10px;padding:8px 10px;cursor:pointer}
    footer{padding:40px 0;margin-top:30px;border-top:1px solid #eee;background:#fafafa}

    .banner{position:relative;border:2px dashed #e2e8f0;border-radius:16px;margin:12px 0;overflow:hidden;background:#f8fffc}
    .banner img{width:100%;display:block}

    dialog{border:none;border-radius:16px;max-width:680px;width:96%;padding:0;}
    .modal{padding:16px}
    .modal h3{margin:0 0 12px}
    .modal .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .modal input,.modal textarea,.modal select{width:100%;border:1px solid #e5e7eb;border-radius:10px;padding:10px 12px;font-size:14px}
    .modal textarea{min-height:100px}

    .detail{display:grid;grid-template-columns:1.2fr 1fr;gap:18px}
    .carousel{position:relative;border:1px solid #eee;border-radius:12px;overflow:hidden}
    .carousel img{width:100%;aspect-ratio:4/3;object-fit:cover}
    .carousel .nav{position:absolute;inset:0;display:flex;justify-content:space-between;align-items:center}
    .carousel .nav button{background:rgba(255,255,255,.9);border:none;border-radius:999px;padding:8px 10px;margin:8px}

    .chat-fab{position:fixed;right:14px;bottom:14px;background:var(--green);color:#fff;width:58px;height:58px;border-radius:999px;display:flex;align-items:center;justify-content:center;font-size:26px;cursor:pointer;box-shadow:0 8px 20px rgba(0,0,0,.15);z-index:40}
    .chat{position:fixed;right:14px;bottom:86px;width:320px;max-height:60vh;background:#fff;border:1px solid #eee;border-radius:16px;overflow:hidden;display:none;flex-direction:column;z-index:40}
    .chat header{position:unset;border-bottom:1px solid #eee}
    .chat .msgs{padding:10px;overflow:auto;display:flex;flex-direction:column;gap:8px}
    .msg{padding:8px 10px;border-radius:12px;max-width:80%}
    .msg.me{background:#e8fff5;align-self:flex-end}
    .msg.other{background:#f3f4f6}
    .chat .inp{display:flex;gap:8px;padding:10px;border-top:1px solid #eee}
    .chat .inp input{flex:1;border:1px solid #e5e7eb;border-radius:12px;padding:10px}

    #splash{position:fixed;inset:0;background:#fff;display:flex;align-items:center;justify-content:center;z-index:50}
    .loader{position:relative;width:160px;height:160px;border-radius:50%;border:10px solid #e5f4ef;border-top-color:var(--green);animation:spin 1s linear infinite}
    .loader span{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-weight:900;color:var(--green);font-size:28px;letter-spacing:1px}
    @keyframes spin{to{transform:rotate(360deg)}}

    @media (max-width:1024px){.grid{grid-template-columns:repeat(3,1fr)}.detail{grid-template-columns:1fr}}
    @media (max-width:720px){.grid{grid-template-columns:repeat(2,1fr)}.search-row{grid-template-columns:1fr 1fr 1fr}.search-row select:nth-child(4){grid-column:1/-1}}
    @media (max-width:460px){.grid{grid-template-columns:1fr}.search-row{grid-template-columns:1fr 1fr}.search-row select:nth-child(3){grid-column:1/-1}}
  </style>
</head>
<body>
  <!-- Splash 5s -->
  <div id="splash"><div class="loader"><span>KOLO</span></div></div>

  <header>
    <div class="wrap">
      <div class="top">
        <div class="logo" aria-label="KOLO">
          <!-- SVG –ª–æ–≥–æ—Ç–∏–ø -->
          <svg viewBox="0 0 100 100" aria-hidden="true">
            <circle cx="50" cy="50" r="48" fill="#10b981"/>
            <circle cx="50" cy="50" r="40" fill="none" stroke="#fff" stroke-width="6"/>
            <text x="50" y="58" font-size="36" font-weight="800" text-anchor="middle" fill="#fff" font-family="Montserrat,Arial">KOLO</text>
          </svg>
          <span>KOLO ‚Äî –¥–æ—à–∫–∞ –æ–≥–æ–ª–æ—à–µ–Ω—å</span>
          <span class="pill" id="visitors">–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤: ‚Äî</span>
        </div>
        <div style="margin-left:auto;display:flex;gap:8px">
          <button class="btn" id="btnAdd">–î–æ–¥–∞—Ç–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è</button>
          <button class="btn secondary" id="btnTop">HOT-–¢–û–ü</button>
        </div>
      </div>

      <div class="banner" id="bannerBox" hidden>
        <a id="bannerLink" target="_blank" rel="noopener"><img id="bannerImg" alt="–†–µ–∫–ª–∞–º–Ω–∏–π –±–∞–Ω–µ—Ä"></a>
      </div>

      <div class="search-row">
        <input id="q" placeholder="" autocomplete="off" aria-label="–ö–ª—é—á–æ–≤–µ —Å–ª–æ–≤–æ"/>
        <select id="cat">
          <option value="">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</option>
          <option>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option><option>–ù–µ—Ä—É—Ö–æ–º—ñ—Å—Ç—å</option><option>–ï–ª–µ–∫—Ç—Ä–æ–Ω—ñ–∫–∞</option><option>–î—ñ–º —ñ —Å–∞–¥</option>
          <option>–î–∏—Ç—è—á–∏–π —Å–≤—ñ—Ç</option><option>–•–æ–±—ñ —Ç–∞ —Å–ø–æ—Ä—Ç</option><option>–¢–≤–∞—Ä–∏–Ω–∏</option><option>–ë—ñ–∑–Ω–µ—Å —ñ –ø–æ—Å–ª—É–≥–∏</option>
          <option>–†–æ–±–æ—Ç–∞</option><option>–ú–æ–¥–∞ —ñ —Å—Ç–∏–ª—å</option><option>–ó–∞–ø—á–∞—Å—Ç–∏–Ω–∏</option><option>–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ</option>
        </select>
        <select id="region">
          <option value="">–û–±–ª–∞—Å—Ç—å</option>
          <option>–û–¥–µ—Å—å–∫–∞</option><option>–ö–∏—ó–≤—Å—å–∫–∞</option><option>–õ—å–≤—ñ–≤—Å—å–∫–∞</option><option>–•–∞—Ä–∫—ñ–≤—Å—å–∫–∞</option>
          <option>–î–Ω—ñ–ø—Ä–æ–ø–µ—Ç—Ä–æ–≤—Å—å–∫–∞</option><option>–ó–∞–ø–æ—Ä—ñ–∑—å–∫–∞</option><option>–ú–∏–∫–æ–ª–∞—ó–≤—Å—å–∫–∞</option><option>–•–µ—Ä—Å–æ–Ω—Å—å–∫–∞</option>
          <option>–í–æ–ª–∏–Ω—Å—å–∫–∞</option><option>–í—ñ–Ω–Ω–∏—Ü—å–∫–∞</option><option>–ß–µ—Ä–∫–∞—Å—å–∫–∞</option><option>–ß–µ—Ä–Ω—ñ–≥—ñ–≤—Å—å–∫–∞</option>
          <option>–ß–µ—Ä–Ω—ñ–≤–µ—Ü—å–∫–∞</option><option>–ü–æ–ª—Ç–∞–≤—Å—å–∫–∞</option><option>–°—É–º—Å—å–∫–∞</option><option>–ö—ñ—Ä–æ–≤–æ–≥—Ä–∞–¥—Å—å–∫–∞</option>
          <option>–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫–∞</option><option>–†—ñ–≤–Ω–µ–Ω—Å—å–∫–∞</option><option>–¢–µ—Ä–Ω–æ–ø—ñ–ª—å—Å—å–∫–∞</option><option>–ó–∞–∫–∞—Ä–ø–∞—Ç—Å—å–∫–∞</option>
          <option>–ñ–∏—Ç–æ–º–∏—Ä—Å—å–∫–∞</option><option>–•–º–µ–ª—å–Ω–∏—Ü—å–∫–∞</option><option>–õ—É–≥–∞–Ω—Å—å–∫–∞</option><option>–î–æ–Ω–µ—Ü—å–∫–∞</option>
        </select>
        <button class="btn" id="btnSearch">–ü–æ—à—É–∫</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <h2 style="margin:12px 0">HOT –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó</h2>
    <div class="grid" id="hotGrid"></div>

    <h2 style="margin:22px 0 12px">–ù–æ–≤—ñ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è</h2>
    <div class="grid" id="listGrid"></div>
  </main>

  <footer>
    <div class="wrap" style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap">
      <div>¬© KOLO, 2025</div>
      <div style="display:flex;gap:8px;align-items:center">
        <span class="chip">–ó–≤–∏—á–∞–π–Ω–µ ‚Äî 39 –≥—Ä–Ω/30 –¥–Ω—ñ–≤</span>
        <span class="chip" style="background:#ffecec;border-color:#ffd1d1;color:#a10000">HOT ‚Äî 299 –≥—Ä–Ω/7 –¥–Ω—ñ–≤</span>
        <span class="chip">–ë–∞–Ω–µ—Ä ‚Äî 999 –≥—Ä–Ω/7 –¥–Ω—ñ–≤</span>
      </div>
    </div>
  </footer>

  <!-- –î–µ—Ç–∞–ª—ñ -->
  <dialog id="dlgDetail"><div class="modal"><div id="detail"></div>
    <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px"><button class="btn secondary" onclick="document.getElementById('dlgDetail').close()">–ó–∞–∫—Ä–∏—Ç–∏</button></div>
  </div></dialog>

  <!-- –î–æ–¥–∞–≤–∞–Ω–Ω—è -->
  <dialog id="dlgAdd">
    <div class="modal">
      <h3>–î–æ–¥–∞—Ç–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è</h3>
      <div class="row">
        <input id="f_title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫">
        <input id="f_price" type="number" min="0" step="1" placeholder="–¶—ñ–Ω–∞, –≥—Ä–Ω">
        <select id="f_cat">
          <option>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option><option>–ù–µ—Ä—É—Ö–æ–º—ñ—Å—Ç—å</option><option>–ï–ª–µ–∫—Ç—Ä–æ–Ω—ñ–∫–∞</option><option>–î—ñ–º —ñ —Å–∞–¥</option>
          <option>–î–∏—Ç—è—á–∏–π —Å–≤—ñ—Ç</option><option>–•–æ–±—ñ —Ç–∞ —Å–ø–æ—Ä—Ç</option><option>–¢–≤–∞—Ä–∏–Ω–∏</option><option>–ë—ñ–∑–Ω–µ—Å —ñ –ø–æ—Å–ª—É–≥–∏</option>
          <option>–†–æ–±–æ—Ç–∞</option><option>–ú–æ–¥–∞ —ñ —Å—Ç–∏–ª—å</option><option>–ó–∞–ø—á–∞—Å—Ç–∏–Ω–∏</option><option>–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ</option>
        </select>
        <input id="f_city" placeholder="–ú—ñ—Å—Ç–æ">
      </div>
      <textarea id="f_desc" placeholder="–û–ø–∏—Å"></textarea>
      <div class="row">
        <input id="f_phone" placeholder="+380" value="+380">
        <select id="f_type">
          <option value="normal">–ó–≤–∏—á–∞–π–Ω–µ ‚Äî 39 –≥—Ä–Ω / 30 –¥–Ω—ñ–≤</option>
          <option value="hot">HOT ‚Äî 299 –≥—Ä–Ω / 7 –¥–Ω—ñ–≤</option>
        </select>
      </div>
      <div style="margin:8px 0">–§–æ—Ç–æ: <input id="f_imgs" type="file" accept="image/*" multiple></div>
      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:8px">
        <button class="btn secondary" onclick="document.getElementById('dlgAdd').close()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        <button class="btn" id="btnPay">–û–ø–ª–∞—Ç–∏—Ç–∏ —á–µ—Ä–µ–∑ LiqPay</button>
      </div>
    </div>
  </dialog>

  <!-- –ß–∞—Ç -->
  <div class="chat" id="chatBox">
    <header class="wrap" style="padding:10px">–û–Ω–ª–∞–π–Ω-—á–∞—Ç KOLO</header>
    <div class="msgs" id="msgs"></div>
    <div class="inp"><input id="msg" placeholder="–í–∞—à–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..."><button class="btn" id="send">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button></div>
  </div>
  <div class="chat-fab" id="fab">üí¨</div>

  <!-- Socket.IO –∫–ª—ñ—î–Ω—Ç -->
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js" integrity="sha384-6H0b7mV8N2c3b7s6qg7mO2i3i8b8q1oG6T6D9sS3m7G6O/5D4o7s1b" crossorigin="anonymous"></script>

  <script>
  // ===== CONFIG =====
  // –ó–º—ñ–Ω–∏ —Ç—É—Ç –Ω–∞ —Å–≤—ñ–π —Ç—É–Ω–µ–ª—å (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ https://—Ç–≤—ñ–π-—Å–∞–±–¥–æ–º–µ–Ω.trycloudflare.com)
  const SERVER = localStorage.getItem('kolo_server_url') || 'https://rated-perl-printers-bike.trycloudflare.com';

  // ===== SPLASH (5s) =====
  setTimeout(()=>{ document.getElementById('splash').style.display='none' }, 5000);

  // ===== Helpers =====
  const $ = s => document.querySelector(s);
  const fmtPrice = n => n ? new Intl.NumberFormat('uk-UA').format(n) + ' –≥—Ä–Ω' : '–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ';

  // ===== Socket.IO =====
  const socket = io(SERVER, {transports:['websocket']});
  const ME = localStorage.getItem('kolo_uid') || (localStorage.setItem('kolo_uid', 'u_'+Math.random().toString(36).slice(2)), localStorage.getItem('kolo_uid'));

  socket.on('connect', ()=> socket.emit('hello', {uid:ME}));
  socket.on('visitors', n => $('#visitors').textContent = '–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤: '+n);
  socket.on('banner', b => renderBanner(b));
  socket.on('listings', data => renderAll(data));
  socket.on('chat', m => addMsg(m.from==='admin'?'–ê–¥–º—ñ–Ω':'–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á', m.text, m.from==='me'?'me':'other'));
  socket.on('payresult', m => { if(m.uid===ME) { alert('–û–ø–ª–∞—Ç–∞ —É—Å–ø—ñ—à–Ω–∞! –û–≥–æ–ª–æ—à–µ–Ω–Ω—è –æ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ.'); $('#dlgAdd').close(); }});

  // ===== Banner =====
  function renderBanner(b){
    const box = $('#bannerBox');
    if(!b || !b.enabled){ box.hidden = true; return; }
    box.hidden = false; $('#bannerImg').src = b.image; $('#bannerLink').href = b.link || '#';
  }

  // ===== Listings =====
  let ALL = {hot:[], normal:[]};
  function renderAll(d){ ALL=d; drawGrids(); }
  function drawGrids(){
    const mk = (ad)=>`
      <div class="card" onclick="openDetail('${ad.id}')">
        <div class="imgbox">${ad.type==='hot'?'<div class="tag">HOT</div>':''}<img src="${ad.images[0]}" alt="${ad.title}"></div>
        <div class="ct">
          <div class="title">${ad.title}</div>
          <div class="price"><span class="chip">${fmtPrice(ad.price)}</span></div>
          <div class="meta"><span>${ad.city}</span><span class="dot"></span><span>üëÅÔ∏è ${ad.views||0}</span><span class="dot"></span><span>‚ù§ ${ad.likes||0}</span></div>
        </div>
      </div>`;
    $('#hotGrid').innerHTML = ALL.hot.map(mk).join('');
    $('#listGrid').innerHTML = ALL.normal.map(mk).join('');
  }

  window.openDetail = async function(id){
    const ad = [...ALL.hot, ...ALL.normal].find(a=>a.id===id); if(!ad) return;
    const imgs = ad.images.map((src,i)=>`<img src="${src}" ${i?'style="display:none"':''}>`).join('');
    $('#detail').innerHTML = `<div class='detail'>
      <div class='carousel' id='car'>${imgs}
        <div class='nav'><button onclick='car(-1)'>‚óÄ</button><button onclick='car(1)'>‚ñ∂</button></div>
      </div>
      <div>
        <h3 style='margin-top:0'>${ad.title} ${ad.type==='hot'?'<span class="chip" style="background:#ffecec;border-color:#ffd1d1;color:#a10000">HOT</span>':''}</h3>
        <div class='chip'>${fmtPrice(ad.price)}</div>
        <p style='margin:10px 0;white-space:pre-wrap'>${ad.desc}</p>
        <div class='meta' style='margin:10px 0'>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è: ${ad.cat} ‚Äî ${ad.city}</div>
        <div class='meta'>–ü–µ—Ä–µ–≥–ª—è–¥–∏: <b>${ad.views||0}</b> ¬∑ –õ–∞–π–∫–∏: <b id='lk_${ad.id}'>${ad.likes||0}</b></div>
        <div style='display:flex;gap:8px;margin-top:10px'>
          <button class='btn' onclick="likeAd('${ad.id}');event.stopPropagation()">‚ù§ –ü–æ–¥–æ–±–∞—î—Ç—å—Å—è</button>
          <a class='btn secondary' href='tel:${ad.phone}'>üìû –ü–æ–¥–∑–≤–æ–Ω–∏—Ç–∏</a>
        </div>
      </div>
    </div>`;
    document.getElementById('dlgDetail').showModal();
    fetch(SERVER+`/api/view/${ad.id}`, {method:'POST'});
  }

  window.car = function(dir){
    const box = document.getElementById('car');
    const arr = [...box.querySelectorAll('img')];
    let i = arr.findIndex(x=>x.style.display!=='none'); if(i<0) i=0;
    arr[i].style.display='none'; i = (i+dir+arr.length)%arr.length; arr[i].style.display='block';
  }

  window.likeAd = async function(id){
    const r = await fetch(SERVER+`/api/like/${id}`,{method:'POST'}).then(x=>x.json());
    if(r && r.likes!==undefined){ const el=document.getElementById('lk_'+id); if(el) el.textContent=r.likes; }
  }

  // –î–æ–¥–∞–≤–∞–Ω–Ω—è
  document.getElementById('btnAdd').onclick = ()=> document.getElementById('dlgAdd').showModal();
  document.getElementById('btnTop').onclick = ()=>{ document.getElementById('cat').value=''; document.getElementById('region').value=''; document.getElementById('q').value=''; window.scrollTo({top:0,behavior:'smooth'}); };
  document.getElementById('btnSearch').onclick = ()=> doSearch();

  function doSearch(){
    const q=document.getElementById('q').value.toLowerCase(), c=document.getElementById('cat').value, r=document.getElementById('region').value;
    const F = a => (!q || a.title.toLowerCase().includes(q) || a.desc.toLowerCase().includes(q)) && (!c || a.cat===c) && (!r || (a.region||'')===r);
    const data = {hot:ALL.hot.filter(F), normal:ALL.normal.filter(F)}; renderAll(data);
    fetch(SERVER+'/api/list'); // –æ–Ω–æ–≤–∏—Ç–∏ –ø–æ–≤–Ω—ñ –¥–∞–Ω—ñ –ø—ñ—Å–ª—è —Ñ—ñ–ª—å—Ç—Ä—É
  }

  document.getElementById('btnPay').onclick = async ()=>{
    const fd = new FormData();
    fd.append('title',document.getElementById('f_title').value.trim());
    fd.append('price',document.getElementById('f_price').value||0);
    fd.append('cat',document.getElementById('f_cat').value);
    fd.append('city',document.getElementById('f_city').value.trim());
    fd.append('desc',document.getElementById('f_desc').value.trim());
    fd.append('phone',document.getElementById('f_phone').value.trim());
    fd.append('type',document.getElementById('f_type').value);
    const files = document.getElementById('f_imgs').files; for(const f of files) fd.append('images', f);
    const r = await fetch(SERVER+'/pay/start', {method:'POST', body:fd});
    const j = await r.json();
    if(j.status==='ok'){ alert('–¢–µ—Å—Ç–æ–≤–∞ –æ–ø–ª–∞—Ç–∞ —ñ–Ω—ñ—Ü—ñ–π–æ–≤–∞–Ω–∞ (–±–µ–∑ LiqPay).'); }
  }

  // –ß–∞—Ç
  document.getElementById('fab').onclick = ()=>{
    const b=document.getElementById('chatBox'); b.style.display = b.style.display==='flex' ? 'none' : 'flex';
  };
  document.getElementById('send').onclick = ()=>{
    const v=document.getElementById('msg').value.trim(); if(!v) return; document.getElementById('msg').value='';
    socket.emit('chat', {from:'user', uid:ME, text:v}); addMsg('–Ø', v, 'me');
  };
  function addMsg(who, text, cls){
    const d=document.createElement('div'); d.className='msg '+cls; d.textContent=who+': '+text;
    const m=document.getElementById('msgs'); m.appendChild(d); m.scrollTop=99999;
  }

  // –ü–µ—Ä–≤–∏–Ω–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
  fetch(SERVER+'/api/list').then(r=>r.json()).then(j=>{ renderAll(j.data); renderBanner(j.banner); });
  </script>
</body>
</html>
